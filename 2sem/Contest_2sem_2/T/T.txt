Задача T-Текстовый редактор

Ограничение времени:	2 с
Ограничение памяти:	256 M
Реализовать функцию Undo-Redo для текстового редактора. Программа получает на входе последовательность символов, вводимую пользователем. Для разделения строк используется символ '\n'. В тексте используются следующие спецсимволы:
• < — переход на один символ влево или в конец предыдущей строки
• > — переход на один символ вправо или в начало следующей строки
• ^ — переход на строку выше
• | — переход на строку ниже
• # — удаление символа (нажатие Del)
• @ — отмена последнего действия (Undo)
• $ — повтор последнего отмененного действия (Redo)

Undo и Redo могут встречаться подряд несколько раз. Программа должна вывести текст, получившийся в результате такого редактирования.

Вот правила, более чётко определяющие поведение текстового редактора.
Каждая строка текста заканчивается символом перевода строки, в том числе последняя. Вначале текст содержит одну пустую строку. Текущее место редактирования опредляется позицией в тексте, которую назовём курсором. Курсор никогда не выходит за пределы текста: например, нажатие "вверх" во время редактирования первой строки не приводит к перемещению курсора. Если курсор с помощью символов ^ (вверх) или | (вниз) перемещается на строку, длина которой меньше его текущей горизонтальной позиции, то курсор ставится в конец строки. Отменить/повторить можно действия добавления и удаления символа (в том числе перевода строки, в результате чего строка расщепляется или сливается с соседней). Нерезультативное действие не запоминается (например нажатие Del, когда курсор находится в самом конце текста). Команда Undo в момент, когда нет действий для отмены, не является ошибкой, также как и команда Redo, если нет действий для повтора. После отмены действия курсор возвращается в позицию, которую имел непосредственно перед выполнением этого действия.

Формат входных данных

На вход подаётся последовательность латинский букв, цифр, пробелов, знаков препинания и переводов строк, а также описанных выше специальных символов — суммарной длиной не более 500000.
Гарантируется, что при редактировании текста никакая строка не становилась длиннее 100 символов.

Формат результата

Вывести получившийся текст.

Примеры

Входные данные	                                Результат работы
I a<#often set and wish that i
Could be a kite up in the sky,^<#I|>>>>>>>
And ridee@ upon the@@$$$$$$ breeze and go
Whichever way I CHA@@@chanced to blow.
                                                I often set and wish that I
                                                Could be a kite up in the sky,
                                                And ride upon the breeze and go
                                                Whichever way I chanced to blow.
